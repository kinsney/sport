{% extends "participator_base.html" %}
{% load static from staticfiles %}
{% load tagLibrary %}
{% block scripts %}
{{ block.super }}
<script src="{% static "components/state.min.js"%}"></script>
<script src="{% static "components/tab.min.js"%}"></script>
<script src="{% static "components/api.min.js"%}"></script>
<script>
var currentTab;
  $('.dynamic.menu .item').tab({
    apiSettings: {
      loadingDuration: 300,
      cache   : false,
      context : 'parent',
      auto    : true,
      alwaysRefrsh:true,
      history : false,
      url   : '/participator/ordermanage/{$tab}',
      method: 'post',
      data:{
        csrfmiddlewaretoken:$('input[name="csrfmiddlewaretoken"]').val()
      }
    },
    onLoad:function(tabPath){
         currentTab = tabPath
         $('.cancel').api({
          url:'/participator/cancel/{ordernumber}',
          method:'post',
          data:{
            csrfmiddlewaretoken:$('input[name="csrfmiddlewaretoken"]').val()
          },
          onSuccess:function(message){
            $('.dynamic.menu .item').tab('change tab',currentTab)
          },
          onError:function(message){
              $('.dynamic.menu .item').tab('change tab',currentTab)
          }
      })
       $('.reply .submit.button').api({
          url:'/participator/orderComment/{ordernumber}',
          method:'post',
          serializeForm:true,
          onSuccess:function(message){
              $('.dynamic.menu .item').tab('change tab',currentTab)
          },
          onError:function(message){
              $('.dynamic.menu .item').tab('change tab',currentTab)
          }
      })
      $('.actions a.reply').state({
            text:{
                    inactive:'回复',
                    active:'收起回复',
                },
        onActivate:function(e){
                $(this).closest('.comments').find('form.reply').slideDown()
            },
        onDeactivate:function(e){
          $(this).closest('.comments').find('form.reply').slideUp()
        }
      })
    }
  })
  $('.dynamic.menu .item').tab('change tab','recent')

</script>

{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" href="{% static "css/orderManage.css"%}">
{% endblock %}
{% block participator_nav %}
    {% with active="orderManage" %}{{ block.super }}{% endwith %}
{% endblock %}
{% block main %}
    <div class='ui segment stacked'>
      <h4 class='ui dividing header'>我的收益</h4>
      <div class='ui grid statistics'>
        <div class='statistic  orange'>
          <div class='value'>
          <i class='yen small icon'></i>

          </div>
          <div class='label'>
            当月收益
          </div>
        </div>
        <div class='statistic orange'>
          <div class='value'>
          <i class='star half empty small icon'></i>

          </div>
          <div class='label'>
            接单率
          </div>
        </div>
        <div class='statistic  orange'>
          <div class='value'>
          <i class='thumbs outline up small icon'></i>
            100
          </div>
          <div class='label'>
            已成交
          </div>
        </div>
        <div class='statistic  orange'>
          <div class='value'>
          <i class='wait small icon'></i>
            20:20
          </div>
          <div class='label'>
            平分接单时间
          </div>
        </div>
      </div>
      <div class="ui pointing secondary menu dynamic">
        {% csrf_token %}
        <a class="item active" data-tab='recent'>当前订单</a>
        <a class="item" data-tab='owner'>我是车主</a>
        <a class="item" data-tab='renter'>我是租客</a>
      </div>
      <div data-tab="recent" class="ui tab active">
      </div>
      <div data-tab="owner" class="ui  tab">
      </div>
      <div data-tab="renter" class="ui tab">
      </div>
    </div>
{% endblock %}
